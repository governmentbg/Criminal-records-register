<nb-card class="card-single-page-height" [formGroup]="fullForm.group">
  <nb-card-header class="card-header-shadow">
    <div class="d-flex" style="justify-content: space-between">
      <div class="d-flex align-items-center">
        <div style="font-weight: bold; font-size: 22px">Лица</div>
      </div>
      <div class="d-flex">
        <div>
          <button
            nbButton
            matRipple
            [status]="'success'"
            (click)="onSearch()"
            type="button"
            class="ml-2"
            style="min-width: 100px"
          >
            Търсене
          </button>
        </div>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body class="overflow-scroll">
    <form autocomplete="off">
      <div class="row">
        <div class="form-group col-md-3">
          <cais-input
            [type]="'text'"
            [label]="'ЕГН'"
            [inputFormControl]="fullForm.identifier"
            [parentGroup]="fullForm.group"
          ></cais-input>
        </div>
        <div class="form-group col-md-6">
          <cais-date-precision [formModel]="fullForm.birthDate">
          </cais-date-precision>
        </div>
      </div>
      <div class="row">
        <div class="form-group col-md-3">
          <cais-input
            [type]="'text'"
            [label]="'Име'"
            [inputFormControl]="fullForm.firstName"
            [parentGroup]="fullForm.group"
          ></cais-input>
        </div>
        <div class="form-group col-md-3">
          <cais-input
            [type]="'text'"
            [label]="'Презиме'"
            [inputFormControl]="fullForm.surName"
            [parentGroup]="fullForm.group"
          ></cais-input>
        </div>
        <div class="form-group col-md-3">
          <cais-input
            [type]="'text'"
            [label]="'Фамилия'"
            [inputFormControl]="fullForm.familyName"
            [parentGroup]="fullForm.group"
          ></cais-input>
        </div>
        <div class="form-group col-md-3">
          <cais-input
            [type]="'text'"
            [label]="'Пълно име'"
            [inputFormControl]="fullForm.fullName"
            [parentGroup]="fullForm.group"
          ></cais-input>
        </div>
      </div>
    </form>
  </nb-card-body>
</nb-card>

<igx-grid
  #grid
  igxGridState
  [data]="items$ | async"
  [height]="null"
  [filterStrategy]="noopFilterStrategy"
  [paging]="true"
  [clipboardOptions]="{ copyHeaders: false }"
  [displayDensity]="'cosy'"
  [paginationTemplate]="pager"
  [allowFiltering]="false"
  [primaryKey]="'id'"
  [pinning]="pinningConfig"
  [cellSelection]="'none'"
>
  <igx-grid-toolbar>
    <igx-grid-toolbar-title>Лица</igx-grid-toolbar-title>
    <igx-grid-toolbar-actions>
      <div class="ml-auto">
        <a
          nbButton
          matRipple
          [status]="'success'"
          [routerLink]="['/pages/people/create']"
        >
        <i class="fa fa-plus" aria-hidden="true"></i> &nbsp; Добавяне
        </a>
      </div>
    </igx-grid-toolbar-actions>
  </igx-grid-toolbar>
  <igx-column
    field="id"
    header="Идентификатор"
    [dataType]="'string'"
    [hidden]="true"
  >
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>

  <igx-column field="identifier" header="ЕГН/ЛНЧ/ЛН" [dataType]="'string'">
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>

  <igx-column field="firstName" header="Име" [dataType]="'string'">
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>
  <igx-column field="surName" header="Презиме" [dataType]="'string'">
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>
  <igx-column field="familyName" header="Фамилия" [dataType]="'string'">
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>
  <igx-column field="fullName" header="Пълно име" [dataType]="'string'">
    <ng-template igxCell let-cell="cell">
      <span [title]="cell.value">{{ cell.value }}</span>
    </ng-template>
  </igx-column>
  <igx-column
    field="birthDate"
    header="Дата на раждане"
    dataType="Date"
    [formatter]="this.dateFormatService.formatDate"
  >
    <ng-template igxCell let-cell="cell">
      <span [title]="this.dateFormatService.displayDate(cell.value)">
        {{ this.dateFormatService.displayDate(cell.value) }}
      </span>
    </ng-template>
  </igx-column>

  <igx-column width="150px" header="" [filterable]="false" [pinned]="true">
    <ng-template igxCell let-cell="cell">
      <a mat-icon-button [matMenuTriggerFor]="menu" aria-label="Действия">
        <nb-icon pack="fa" icon="bars"></nb-icon>
      </a>
      <mat-menu #menu="matMenu">
        <button
          mat-menu-item
          [routerLink]="['/pages/']"
          [queryParams]="{ personId: cell.rowData.id }"
        >
          <span class="ml-1">Детайли</span>
        </button>

        <button
          mat-menu-item
          [routerLink]="['/pages/bulletins/create']"
          [queryParams]="{ personId: cell.rowData.id }"
        >
          <span class="ml-1">Бюлетин</span>
        </button>

        <button
          mat-menu-item
          [routerLink]="['/pages/']"
          [queryParams]="{ personId: cell.rowData.id }"
        >
          <span class="ml-1">Свидетелство</span>
        </button>
        <button
          mat-menu-item
          [routerLink]="['/pages/']"
          [queryParams]="{ personId: cell.rowData.id }"
        >
          <span class="ml-1">Напомнителен запис</span>
        </button>
      </mat-menu>
    </ng-template>
  </igx-column>

  <ng-template #pager let-grid>
    <div class="tl-paginator">
      <cais-grid-pager
        [page]="remoteService.pagerParams.page"
        [perPage]="remoteService.pagerParams.perPage"
        [totalCount]="remoteService.pagerParams.totalCount"
        (pagerChange)="pagerChange($event)"
      ></cais-grid-pager>
    </div>
  </ng-template>
</igx-grid>
