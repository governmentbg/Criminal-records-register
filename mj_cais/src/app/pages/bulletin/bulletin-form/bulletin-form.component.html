<nb-card class="card-single-page-height" [formGroup]="fullForm.group">
  <nb-card-header class="card-header-shadow">
    <div class="d-flex" style="justify-content: space-between">
      <div class="d-flex align-items-center">
        <div style="font-weight: bold; font-size: 22px">{{ displayTitle }}</div>
      </div>
      <div class="d-flex">
        <ng-content></ng-content>
        <div>
          <button
            *ngIf="!isForPreview"
            nbButton
            matRipple
            [status]="'success'"
            (click)="submitFunction()"
            type="button"
            class="ml-2"
            style="min-width: 100px"
          >
            Запази
          </button>
        </div>
        <div>
          <button
            *ngIf="!isForPreview && showForUpdate"
            nbButton
            matRipple
            [status]="'success'"
            (click)="updateFunction()"
            type="button"
            class="ml-2"
            style="min-width: 100px"
          >
            Актуализирай
          </button>
        </div>
        <div>
          <button
            nbButton
            matRipple
            (click)="globalCancelFunction()"
            type="button"
            class="ml-2"
            style="min-width: 100px"
          >
            {{ isForPreview ? "Назад" : "Отказ" }}
          </button>
        </div>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body class="overflow-scroll">
    <form autocomplete="off">
      <nb-tabset #nbtabset>
        <nb-tab tabTitle="Основна информация">
          <div class="font-weight-bold">Данни за бюлетин</div>
          <hr />
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Номер'"
                [inputFormControl]="fullForm.registrationNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Бюро съдимост, в което се съхранява'"
                [inputFormControl]="fullForm.csAuthorityName"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'number'"
                [label]="'Пореден номер на бюлетина за лицето '"
                [inputFormControl]="fullForm.sequentialIndex"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Статус'"
                [inputFormControl]="fullForm.statusIdDisplay"
                [parentGroup]="fullForm.group"
                [inputName]="'statusIdDisplay'"
                [items]="dbData.bulletinStatuses"
              ></cais-autocomplete>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Входящ номер към азбучния указател'"
                [inputFormControl]="fullForm.alphabeticalIndex"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'ID на осъждане в ECRIS'"
                [inputFormControl]="fullForm.ecrisConvictionId"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'date'"
                [label]="'Датата на постъпване на хартиения бюлетин'"
                [inputFormControl]="fullForm.bulletinReceivedDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Тип'"
                [inputFormControl]="fullForm.bulletinType"
                [parentGroup]="fullForm.group"
                [inputName]="'bulletinType'"
                [items]="dbData.bulletinTypes"
              ></cais-autocomplete>
            </div>
          </div>

          <div class="font-weight-bold">
            Данни за изготвяне, съставяне и проверка на бюлетин
          </div>
          <hr />

          <div class="row">
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Съд изготвил бюлетината'"
                [inputFormControl]="fullForm.bulletinAuthorityId"
                [parentGroup]="fullForm.group"
                [inputName]="'bulletinAuthorityId'"
                [items]="dbData.decidingAuthorities"
              ></cais-autocomplete>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'date'"
                [label]="'Дата на съставяне на бюлетина'"
                [inputFormControl]="fullForm.bulletinCreateDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="sub-header">Съставил</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Имена'"
                [inputFormControl]="fullForm.createdByNames"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Ддлъжност'"
                [inputFormControl]="fullForm.createdByPosition"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="sub-header">Проверил</div>
          <hr />
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Имена'"
                [inputFormControl]="fullForm.approvedByNames"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Длъжност'"
                [inputFormControl]="fullForm.approvedByPosition"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
        </nb-tab>
        <nb-tab tabTitle="Данни за лицето">
          <div class="font-weight-bold">Имена</div>
          <hr />
          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Име на кирилица'"
                [inputFormControl]="fullForm.firstname"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Презиме на кирилица'"
                [inputFormControl]="fullForm.surname"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Фамилия на кирилица'"
                [inputFormControl]="fullForm.familyname"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Имена на кирилица'"
                [inputFormControl]="fullForm.fullname"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Име на латиница'"
                [inputFormControl]="fullForm.firstnameLat"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Презиме на латиница'"
                [inputFormControl]="fullForm.surnameLat"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Фамилия на латиница'"
                [inputFormControl]="fullForm.familynameLat"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Имена на латиница'"
                [inputFormControl]="fullForm.fullnameLat"
                [parentGroup]="fullForm.group"
              >
              </cais-input>
            </div>
          </div>

          <div class="font-weight-bold">
            Псевдоним или други използвани имена
          </div>
          <app-grid-with-transactions
            [gridTransactions]="fullForm.personAliasTransactions"
          >
            <igx-grid
              #bulletinPersonAliasGrid
              [height]="null"
              [data]="dbData.personAlias"
              [primaryKey]="'id'"
            >
              <igx-grid-toolbar>
                <button
                  igxButton="flat"
                  (click)="bulletinPersonAliasDialog.open()"
                  *ngIf="!isForPreview"
                  class="addProdBtn"
                >
                  <igx-icon>add</igx-icon> Добави
                </button>
              </igx-grid-toolbar>

              <igx-column
                field="id"
                header="Идентификатор"
                [sortable]="false"
                [dataType]="'string'"
                [hidden]="true"
              >
              </igx-column>

              <igx-column
                field="typeName"
                header="Тип"
                [sortable]="true"
                [dataType]="'string'"
              ></igx-column>

              <igx-column
                field="firstname"
                header="Име"
                [sortable]="true"
                [dataType]="'string'"
              ></igx-column>

              <igx-column
                field="surname"
                header="Презиме"
                [sortable]="true"
                [dataType]="'string'"
              ></igx-column>

              <igx-column
                field="familyname"
                header="Фамилия"
                [sortable]="true"
                [dataType]="'string'"
              ></igx-column>

              <igx-column
                field="fullname"
                header="Имена"
                dataType="string"
                [sortable]="true"
              >
              </igx-column>

              <igx-action-strip #actionstrip>
                <button
                  title="Редактирай"
                  igxButton="icon"
                  igxRipple
                  (click)="onOpenEditBulletinPersonAlias(actionstrip.context)"
                >
                  <igx-icon>edit</igx-icon>
                </button>
                <button
                  title="Изтрии"
                  igxButton="icon"
                  igxRipple
                  (click)="onDeleteBulletinPersonAlias(actionstrip.context)"
                >
                  <igx-icon>delete</igx-icon>
                </button>
              </igx-action-strip>
            </igx-grid>
          </app-grid-with-transactions>

          <igx-dialog #bulletinPersonAliasDialog>
            <div class="dialogNewRecord" style="min-width: 1000px">
              <nb-card>
                <nb-card-header>
                  <div class="d-flex" style="justify-content: space-between">
                    <div class="d-flex align-items-center">
                      <h5 style="font-weight: bold">Псевдоним</h5>
                    </div>
                    <div class="d-flex">
                      <div>
                        <button
                          nbButton
                          matRipple
                          [status]="'success'"
                          (click)="onAddOrUpdateBulletinPersonAliasRow()"
                          type="button"
                          class="ml-2"
                        >
                          Потвърди
                        </button>
                      </div>
                      <div>
                        <button
                          nbButton
                          matRipple
                          (click)="onCloseBulletinPersonAliasDilog()"
                          type="button"
                          class="ml-2"
                        >
                          Откажи
                        </button>
                      </div>
                    </div>
                  </div>
                </nb-card-header>
                <nb-card-body>
                  <div class="row mt-2">
                    <div class="form-group col-md-4">
                      <cais-autocomplete
                        [label]="'Тип'"
                        [inputFormControl]="bulletinPersonAliasForm.typeId"
                        [parentGroup]="bulletinPersonAliasForm.group"
                        [items]="dbData.personAliasTypes"
                        [inputName]="'typeId'"
                      >
                      </cais-autocomplete>
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="form-group col-md-6">
                      <cais-input
                        [type]="'text'"
                        [label]="'Име'"
                        [inputFormControl]="bulletinPersonAliasForm.firstname"
                        [parentGroup]="bulletinPersonAliasForm.group"
                        [inputName]="'firstname'"
                      >
                      </cais-input>
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="form-group col-md-6">
                      <cais-input
                        [type]="'text'"
                        [label]="'Презиме'"
                        [inputFormControl]="bulletinPersonAliasForm.surname"
                        [parentGroup]="bulletinPersonAliasForm.group"
                        [inputName]="'surname'"
                      >
                      </cais-input>
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="form-group col-md-6">
                      <cais-input
                        [type]="'text'"
                        [label]="'Фамилия'"
                        [inputFormControl]="bulletinPersonAliasForm.familyname"
                        [parentGroup]="bulletinPersonAliasForm.group"
                        [inputName]="'familyname'"
                      >
                      </cais-input>
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="form-group col-md-6">
                      <cais-input
                        [type]="'text'"
                        [label]="'Имена'"
                        [inputFormControl]="bulletinPersonAliasForm.fullname"
                        [parentGroup]="bulletinPersonAliasForm.group"
                        [inputName]="'fullname'"
                      >
                      </cais-input>
                    </div>
                  </div>
                </nb-card-body>
              </nb-card>
            </div>
          </igx-dialog>

          <div class="row mt-3">
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Пол'"
                [inputFormControl]="fullForm.sex"
                [parentGroup]="fullForm.group"
                [inputName]="'sex'"
                [items]="dbData.genderTypes"
              ></cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на раждане'"
                [inputFormControl]="fullForm.birthDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'ЕГН'"
                [inputFormControl]="fullForm.egn"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'ЛН'"
                [inputFormControl]="fullForm.ln"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'ЛНЧ'"
                [inputFormControl]="fullForm.lnch"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="font-weight-bold">Място на раждане</div>
          <hr />
          <cais-address-form
            [parentForm]="fullForm.address"
          ></cais-address-form>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-multiple-choose
                [label]="'Гражданство'"
                [inputFormControl]="fullForm.nationalities"
                [parentGroup]="fullForm.group"
                [items]="dbData.countries"
              >
              </cais-multiple-choose>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'АФИС номер'"
                [inputFormControl]="fullForm.afisNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="font-weight-bold">Документ за самоличност</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Номер на документ'"
                [inputFormControl]="fullForm.idDocNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Категория'"
                [inputFormControl]="fullForm.idDocCategoryId"
                [parentGroup]="fullForm.group"
                [inputName]="'idDocCategoryId'"
                [items]="dbData.idDocumentCategoryTypes"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Друга категория в случай че липсва в списъка'"
                [inputFormControl]="fullForm.idDocTypeDescr"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Издаващ орган'"
                [inputFormControl]="fullForm.idDocIssuingAuthority"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на издаване'"
                [inputFormControl]="fullForm.idDocIssuingDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на валидност'"
                [inputFormControl]="fullForm.idDocValidDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="font-weight-bold">Родители</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Майка - име'"
                [inputFormControl]="fullForm.motherFirstname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Майка - презиме'"
                [inputFormControl]="fullForm.motherSurname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Майка - фамилия'"
                [inputFormControl]="fullForm.motherFamilyname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Майка - имена'"
                [inputFormControl]="fullForm.motherFullname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Баща - име'"
                [inputFormControl]="fullForm.fatherFirstname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Баща - презиме'"
                [inputFormControl]="fullForm.fatherSurname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Баща - фамилия'"
                [inputFormControl]="fullForm.fatherFamilyname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Баща - имена'"
                [inputFormControl]="fullForm.fatherFullname"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
        </nb-tab>

        <nb-tab tabTitle="Осъждане">
          <div class="font-weight-bold">Данни за акта</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Вид'"
                [inputFormControl]="fullForm.decisionTypeId"
                [parentGroup]="fullForm.group"
                [inputName]="'decisionTypeId'"
                [items]="dbData.decisionTypes"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Номер'"
                [inputFormControl]="fullForm.decisionNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на издаване'"
                [inputFormControl]="fullForm.decisionDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на влизане в сила'"
                [inputFormControl]="fullForm.decisionFinalDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-4">
              <cais-autocomplete
                [label]="'Съдебен орган издал акта'"
                [inputFormControl]="fullForm.decidingAuthId"
                [parentGroup]="fullForm.group"
                [inputName]="'decidingAuthId'"
                [items]="dbData.decidingAuthorities"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'ECLI номер'"
                [inputFormControl]="fullForm.decisionEcli"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="font-weight-bold">Данни за делото</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Вид'"
                [inputFormControl]="fullForm.caseTypeId"
                [parentGroup]="fullForm.group"
                [inputName]="'caseTypeId'"
                [items]="dbData.caseTypes"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Номер'"
                [inputFormControl]="fullForm.caseNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'number'"
                [label]="'Година'"
                [inputFormControl]="fullForm.caseYear"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-9">
              <cais-input
                [type]="'text'"
                [label]="'Забележки'"
                [inputFormControl]="fullForm.convRemarks"
                [parentGroup]="fullForm.group"
                [inputType]="InputTypeConstants.TextArea"
              ></cais-input>
            </div>
          </div>
        </nb-tab>

        <nb-tab tabTitle="Престъпления">
          <cais-bulletin-offences-form
            #bulletineOffences
            [bulletinOffenceTransactions]="fullForm.offancesTransactions"
            [dbData]="dbData"
            [isForPreview]="isForPreview"
          ></cais-bulletin-offences-form>
        </nb-tab>

        <nb-tab tabTitle="Наказания">
          <cais-bulletin-sanctions-form
            #bulletineSanctions
            [bulletinSanctionsTransactions]="fullForm.sanctionsTransactions"
            [dbData]="dbData"
            [isForPreview]="isForPreview"
          >
          </cais-bulletin-sanctions-form>
        </nb-tab>

        <nb-tab tabTitle="Доп. сведения">
          <cais-bulletin-decision-form
            #bulletineDecisions
            [bulletinDecisionsTransactions]="fullForm.decisionsTransactions"
            [dbData]="dbData"
            [isForPreview]="isForPreview"
          >
          </cais-bulletin-decision-form>
        </nb-tab>

        <nb-tab tabTitle="Уведомления">
          <span>Content #7</span>
        </nb-tab>

        <nb-tab tabTitle="Документи">
          <cais-bulletin-document-form
            #bulletineDocuments
            [bulletinForm]="fullForm"
            [showAddDeleteButton]="
              (isEdit() && !isForPreview) || (!isEdit() && isForPreview)
            "
            [documents]="dbData.documents"
            [dbData]="dbData"
          >
          </cais-bulletin-document-form>
        </nb-tab>

        <nb-tab tabTitle="Одит">
          <span>Content #9</span>
        </nb-tab>
      </nb-tabset>
    </form>
  </nb-card-body>
</nb-card>
