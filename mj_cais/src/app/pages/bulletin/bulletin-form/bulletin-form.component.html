<nb-card class="card-single-page-height" [formGroup]="fullForm.group">
  <nb-card-header class="card-header-shadow">
    <cais-card-header
      [label]="displayTitle"
      [onSaveFunction]="submitFunction"
      [onCancelFunction]="globalCancelFunction"
      [setForPreview]="setEditToBeForPreview"
    >
      <div>
        <button
          *ngIf="isForPreview && showForUpdate"
          nbButton
          matRipple
          [status]="'success'"
          (click)="openUpdateConfirmationDialog()"
          type="button"
          class="ml-2"
          style="min-width: 100px"
        >
          Актуализирай
        </button>
      </div>
    </cais-card-header>
  </nb-card-header>
  <nb-card-body class="overflow-scroll">
    <form autocomplete="off">
      <nb-tabset #nbtabset>
        <nb-tab tabTitle="Основна информация">
          <div class="font-weight-bold">Данни за бюлетин</div>
          <hr />
          <div class="row">
            <ng-container *ngIf="isEdit()">
              <div class="form-group col-md-6">
                <cais-input
                  [type]="'text'"
                  [label]="'Номер'"
                  [inputFormControl]="fullForm.registrationNumberDisplay"
                  [parentGroup]="fullForm.group"
                ></cais-input>
              </div>
            </ng-container>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Бюро съдимост, в което се съхранява'"
                [inputFormControl]="fullForm.csAuthorityName"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'number'"
                [label]="'Пореден номер на бюлетина за лицето'"
                [inputFormControl]="fullForm.sequentialIndex"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Статус'"
                [inputFormControl]="fullForm.statusIdDisplay"
                [parentGroup]="fullForm.group"
                [inputName]="'statusIdDisplay'"
                [items]="dbData.bulletinStatuses"
              ></cais-autocomplete>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Входящ номер към азбучния указател'"
                [inputFormControl]="fullForm.alphabeticalIndex"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'ID на осъждане в ECRIS'"
                [inputFormControl]="fullForm.ecrisConvictionId"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'date'"
                [label]="'Датата на постъпване на хартиения бюлетин'"
                [inputFormControl]="fullForm.bulletinReceivedDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Тип'"
                [inputFormControl]="fullForm.bulletinType"
                [parentGroup]="fullForm.group"
                [inputName]="'bulletinType'"
                [items]="dbData.bulletinTypes"
              ></cais-autocomplete>
            </div>
          </div>

          <div class="font-weight-bold">
            Данни за изготвяне, съставяне и проверка на бюлетин
          </div>
          <hr />

          <div class="row">
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Съд изготвил бюлетина'"
                [inputFormControl]="fullForm.bulletinAuthorityId"
                [parentGroup]="fullForm.group"
                [inputName]="'bulletinAuthorityId'"
                [items]="dbData.decidingAuthorities"
              ></cais-autocomplete>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'date'"
                [label]="'Дата на съставяне на бюлетина'"
                [inputFormControl]="fullForm.bulletinCreateDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="sub-header">Съставил</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Имена'"
                [inputFormControl]="fullForm.createdByNames"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Длъжност'"
                [inputFormControl]="fullForm.createdByPosition"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="sub-header">Проверил</div>
          <hr />
          <div class="row">
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Имена'"
                [inputFormControl]="fullForm.approvedByNames"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-input
                [type]="'text'"
                [label]="'Длъжност'"
                [inputFormControl]="fullForm.approvedByPosition"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
        </nb-tab>
        <nb-tab tabTitle="Данни за лицето">
          <cais-person-form
            [personForm]="fullForm.person"
            [isEditable]="isBulletinPersonAliasEditable"
            [personAliasTypes]="dbData.personAliasTypes"
            [genderTypes]="dbData.genderTypes"
            [countries]="dbData.countries"
            [idDocumentCategoryTypes]="dbData.idDocumentCategoryTypes"
            [personAliasGridData]="dbData.personAlias"
            [contextType]="PersonContextEnum.Bulletin"
          >
          </cais-person-form>
        </nb-tab>

        <nb-tab tabTitle="Осъждане">
          <div class="font-weight-bold">Данни за акта</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Вид'"
                [inputFormControl]="fullForm.decisionTypeId"
                [parentGroup]="fullForm.group"
                [inputName]="'decisionTypeId'"
                [items]="dbData.decisionTypes"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Номер'"
                [inputFormControl]="fullForm.decisionNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на издаване'"
                [inputFormControl]="fullForm.decisionDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'date'"
                [label]="'Дата на влизане в сила'"
                [inputFormControl]="fullForm.decisionFinalDate"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Съдебен орган издал акта'"
                [inputFormControl]="fullForm.decidingAuthId"
                [parentGroup]="fullForm.group"
                [inputName]="'decidingAuthId'"
                [items]="dbData.decidingAuthorities"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'ECLI номер'"
                [inputFormControl]="fullForm.decisionEcli"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>

          <div class="font-weight-bold">Данни за делото</div>
          <hr />

          <div class="row">
            <div class="form-group col-md-3">
              <cais-autocomplete
                [label]="'Вид'"
                [inputFormControl]="fullForm.caseTypeId"
                [parentGroup]="fullForm.group"
                [inputName]="'caseTypeId'"
                [items]="dbData.caseTypes"
              >
              </cais-autocomplete>
            </div>
            <div class="form-group col-md-3">
              <cais-input
                [type]="'text'"
                [label]="'Номер'"
                [inputFormControl]="fullForm.caseNumber"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
            <div class="form-group col-md-2">
              <cais-input
                [type]="'number'"
                [label]="'Година'"
                [inputFormControl]="fullForm.caseYear"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <cais-autocomplete
                [label]="'Съд на делото'"
                [inputFormControl]="fullForm.caseAuthId"
                [parentGroup]="fullForm.group"
                [inputName]="'caseAuthId'"
                [items]="dbData.decidingAuthorities"
              >
              </cais-autocomplete>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-9">
              <cais-input
                [type]="'text'"
                [label]="'Извлечение от акта на съда'"
                [inputFormControl]="fullForm.convRemarks"
                [parentGroup]="fullForm.group"
                [inputType]="InputTypeConstants.TextArea"
              ></cais-input>
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-md-5">
              <div
                class="nb-form-control-container"
                style="
                  height: 40px;
                  max-width: 100%;
                  display: flex;
                  align-items: center;
                "
              >
                <nb-checkbox [formControl]="fullForm.prevSuspSent"
                  >Постановено изтърпяване на предходна условна
                  присъда</nb-checkbox
                >
              </div>
            </div>
            <div class="col-md-3">
              <div
                class="nb-form-control-container"
                style="
                  height: 40px;
                  max-width: 100%;
                  display: flex;
                  align-items: center;
                "
              >
                <nb-checkbox
                  (change)="onNoSanctionChange($event)"
                  [formControl]="fullForm.noSanction"
                  >Деецът не е наказан съгласно НК
                </nb-checkbox>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-4">
              <cais-input
                [type]="'text'"
                [label]="'Номер на предходна присъда'"
                [inputFormControl]="fullForm.prevSuspSentDescr"
                [parentGroup]="fullForm.group"
              ></cais-input>
            </div>
          </div>
        </nb-tab>

        <nb-tab tabTitle="Престъпления">
          <cais-bulletin-offences-form
            #bulletineOffences
            [bulletinOffenceTransactions]="fullForm.offancesTransactions"
            [dbData]="dbData"
            [isForPreview]="!isOffancesEditable"
          ></cais-bulletin-offences-form>
        </nb-tab>

        <nb-tab tabTitle="Наказания">
          <cais-bulletin-sanctions-form
            #bulletineSanctions
            [bulletinSanctionsTransactions]="fullForm.sanctionsTransactions"
            [dbData]="dbData"
            [isForPreview]="!isSanctionsEditable"
            [decisionDateInput]="fullForm.decisionDate"
            [isNoSanction]="isNoSanctionCheck"
          >
          </cais-bulletin-sanctions-form>
        </nb-tab>

        <nb-tab tabTitle="Доп. сведения">
          <cais-bulletin-decision-form
            #bulletineDecisions
            [bulletinDecisionsTransactions]="fullForm.decisionsTransactions"
            [dbData]="dbData"
            [isForPreview]="!isDecisionEditable"
          >
          </cais-bulletin-decision-form>
        </nb-tab>
        <nb-tab tabTitle="Уведомления" *ngIf="isEdit() || isForPreview">
          <nb-tabset #nbtabset>
            <nb-tab
              tabTitle="Уведомяване за настъпили обстоятелства по чл. 30, чл.22"
            >
              <cais-bulletin-events-article-overview
                [bulletinId]="fullForm.id.value"
              ></cais-bulletin-events-article-overview>
            </nb-tab>
            <nb-tab
              tabTitle="Уведомяване за променен съдебен статус на осъдено лице"
            >
              <cais-bulletin-events-document-overview
                [bulletinId]="fullForm.id.value"
              ></cais-bulletin-events-document-overview>
            </nb-tab>
          </nb-tabset>
        </nb-tab>

        <nb-tab tabTitle="Документи" *ngIf="isEdit() || isForPreview">
          <cais-bulletin-document-form
            #bulletineDocuments
            [bulletinForm]="fullForm"
            [showAddDeleteButton]="isDocumentsEditable"
            [documents]="dbData.documents"
            [dbData]="dbData"
          >
          </cais-bulletin-document-form>
        </nb-tab>

        <nb-tab tabTitle="Изтърпени наказания" *ngIf="isEdit() || isForPreview">
          <cais-bulletin-isin-form></cais-bulletin-isin-form>
        </nb-tab>

        <nb-tab tabTitle="Одит" *ngIf="isEdit() || isForPreview">
          <cais-bulletin-status-history-overview
            [historyData]="dbData.bulletinStatusHistoryData"
          >
          </cais-bulletin-status-history-overview>
        </nb-tab>
      </nb-tabset>
    </form>
  </nb-card-body>
</nb-card>
