<nb-card>
  <tl-linear-progress
    [visible]="this.remoteService.isLoading"
  ></tl-linear-progress>
  <igx-grid
    #grid
    igxGridState
    [data]="items$ | async"
    [height]="null"
    [filterStrategy]="noopFilterStrategy"
    [sortStrategy]="noopSortStrategy"
    [paging]="true"
    [clipboardOptions]="{ copyHeaders: false }"
    [displayDensity]="'cosy'"
    (onSortingDone)="sortingDone($event)"
    (onFilteringDone)="filteringDone($event)"
    (onSelection)="cellSelection($event)"
    [paginationTemplate]="pager"
    [allowFiltering]="true"
    [primaryKey]="'id'"
    [pinning]="pinningConfig"
    [cellSelection]="'none'"
  >
    <igx-grid-toolbar>
      <igx-grid-toolbar-title>
        <span class="fw-bold"
          >Потвърждение за плащане</span
        ></igx-grid-toolbar-title
      >
      <igx-grid-toolbar-actions>
        <div class="d-flex gap-2">
          <nb-toggle
            (checkedChange)="onShowAll($event)"
            status="info"
            labelPosition="left"
            >Всички е-свидетелства
          </nb-toggle>
          <igx-grid-toolbar-hiding class="mt-1"></igx-grid-toolbar-hiding>
        </div>
      </igx-grid-toolbar-actions>
    </igx-grid-toolbar>

    <igx-column
      field="id"
      header="Идентификатор"
      [sortable]="true"
      [dataType]="'number'"
      [hidden]="true"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="createdOn"
      header="Дата на заявяване"
      [sortable]="true"
      [dataType]="'date'"
      [width]="'13%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="this.dateFormatService.displayDate(cell.value)">
          {{ this.dateFormatService.displayDate(cell.value) }}
        </span>
      </ng-template>
    </igx-column>
    <igx-column
      field="statusName"
      header="Статус"
      [sortable]="true"
      [dataType]="'string'"
      [hidden]="hideStatus"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="registrationNumber"
      header="Регистрационен номер"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'16%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>

    <igx-column
      field="egn"
      header="ЕГН"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'13%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>

    <igx-column
      field="firstname"
      header="Първо име"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'14%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="surname"
      header="Презиме"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'14%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="familyname"
      header="Фамилия"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'14%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="fullname"
      header="Име"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'21%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>

    <igx-column
      field="purpose"
      header="Цел"
      [sortable]="true"
      [dataType]="'string'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="purposeName"
      header="Цел свободен текст"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'16%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>
    <igx-column
      field="paymentMethodName"
      header="Начин на плащане"
      [sortable]="true"
      [dataType]="'string'"
      [width]="'13%'"
    >
      <ng-template igxCell let-cell="cell">
        <span [title]="cell.value">{{ cell.value }}</span>
      </ng-template>
    </igx-column>

    <igx-column
      width="120px"
      header="Действия"
      [sortable]="false"
      [filterable]="false"
      [pinned]="true"
      [disableHiding]="true"
    >
      <ng-template igxCell let-cell="cell">
        <div class="cell-center">
          <div class="d-flex gap-3">
            <a
              [title]="'Преглед'"
              [routerLink]="[
                '/pages/e-applicaiton/check-payment/preview',
                cell.rowData.id
              ]"
            >
              <nb-icon pack="fa" icon="eye"></nb-icon>
            </a>
            <button
              class="btn btn-link"
              *ngIf="hideStatus"
              [title]="'Потвърди плащане'"
              (click)="confirmPayment(cell.rowData.id)"
            >
              <nb-icon pack="fa" icon="check"></nb-icon>
            </button>
          </div>
        </div>
      </ng-template>
    </igx-column>

    <ng-template #pager let-grid>
      <div class="tl-paginator">
        <cais-grid-pager
          [page]="remoteService.pagerParams.page"
          [perPage]="remoteService.pagerParams.perPage"
          [totalCount]="remoteService.pagerParams.totalCount"
          (pagerChange)="pagerChange($event)"
        ></cais-grid-pager>
      </div>
    </ng-template>
  </igx-grid>
</nb-card>
